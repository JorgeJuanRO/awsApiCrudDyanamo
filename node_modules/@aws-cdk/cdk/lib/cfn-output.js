"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cfn_element_1 = require("./cfn-element");
const construct_1 = require("./construct");
class CfnOutput extends cfn_element_1.CfnElement {
    /**
     * Creates an CfnOutput value for this stack.
     * @param scope The parent construct.
     * @param props CfnOutput properties.
     */
    constructor(scope, id, props) {
        super(scope, id);
        if (props.value === undefined) {
            throw new Error(`Missing value for CloudFormation output at path "${this.node.path}"`);
        }
        this.description = props.description;
        this._value = props.value;
        this.condition = props.condition;
        this.disableExport = props.disableExport !== undefined ? props.disableExport : false;
        if (props.export && this.disableExport) {
            throw new Error('Cannot set `disableExport` and specify an export name');
        }
        this.export = props.export;
        if (props.export) {
            this.export = props.export;
        }
    }
    /**
     * The value of the property returned by the aws cloudformation describe-stacks command.
     * The value of an output can include literals, parameter references, pseudo-parameters,
     * a mapping value, or intrinsic functions.
     */
    get value() {
        return this._value;
    }
    /**
     * Returns an FnImportValue bound to this export name.
     */
    makeImportValue() {
        return fn().importValue(this.obtainExportName());
    }
    /**
     * @internal
     */
    _toCloudFormation() {
        return {
            Outputs: {
                [this.logicalId]: {
                    Description: this.description,
                    Value: this.value,
                    Export: this.export != null ? { Name: this.export } : undefined,
                    Condition: this.condition ? this.condition.logicalId : undefined
                }
            }
        };
    }
    /**
     * Allocate an export name for this `CfnOutput` if not already done.
     */
    obtainExportName() {
        if (!this.export && this.disableExport) {
            throw new Error('Cannot create an ImportValue; `disableExport` has been set.');
        }
        if (!this.export) {
            this.export = this.uniqueOutputName();
        }
        return this.export;
    }
    /**
     * Automatically determine an output name for use with FnImportValue
     *
     * This gets called in case the user hasn't specified an export name but is
     * taking an action that requires exporting. We namespace with the stack name
     * to reduce chances of collissions between CDK apps.
     */
    uniqueOutputName() {
        // prefix export name with stack name since exports are global within account + region.
        const stackName = this.stack.stackName;
        return (stackName ? stackName + ':' : '') + this.logicalId;
    }
}
exports.CfnOutput = CfnOutput;
/**
 * An output for a list of strings.
 *
 * Exports a list of Tokens via an CfnOutput variable, and return a list of Tokens
 * that selects the imported values for them.
 */
class StringListCfnOutput extends construct_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        this.separator = props.separator || ',';
        this.length = props.values.length;
        this.output = new CfnOutput(this, 'Resource', {
            description: props.description,
            condition: props.condition,
            disableExport: props.disableExport,
            export: props.export,
            value: fn().join(this.separator, props.values)
        });
    }
    /**
     * Return an array of imported values for this CfnOutput
     */
    makeImportValues() {
        const combined = this.output.makeImportValue();
        const ret = [];
        for (let i = 0; i < this.length; i++) {
            ret.push(fn().select(i, fn().split(this.separator, combined)));
        }
        return ret;
    }
}
exports.StringListCfnOutput = StringListCfnOutput;
function fn() {
    // Lazy loading of "Fn" module to break dependency cycles on startup
    return require('./fn').Fn;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2ZuLW91dHB1dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNmbi1vdXRwdXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwrQ0FBMkM7QUFDM0MsMkNBQXdDO0FBaUR4QyxNQUFhLFNBQVUsU0FBUSx3QkFBVTtJQTBCdkM7Ozs7T0FJRztJQUNILFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBcUI7UUFDN0QsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixJQUFJLEtBQUssQ0FBQyxLQUFLLEtBQUssU0FBUyxFQUFFO1lBQzdCLE1BQU0sSUFBSSxLQUFLLENBQUMsb0RBQW9ELElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztTQUN4RjtRQUVELElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQztRQUNyQyxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFDMUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDO1FBRWpDLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDLGFBQWEsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUVyRixJQUFJLEtBQUssQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUN0QyxNQUFNLElBQUksS0FBSyxDQUFDLHVEQUF1RCxDQUFDLENBQUM7U0FDMUU7UUFFRCxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFFM0IsSUFBSSxLQUFLLENBQUMsTUFBTSxFQUFFO1lBQ2hCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztTQUM1QjtJQUNILENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsSUFBVyxLQUFLO1FBQ2QsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3JCLENBQUM7SUFFRDs7T0FFRztJQUNJLGVBQWU7UUFDcEIsT0FBTyxFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRUQ7O09BRUc7SUFDSSxpQkFBaUI7UUFDdEIsT0FBTztZQUNMLE9BQU8sRUFBRTtnQkFDUCxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRTtvQkFDaEIsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXO29CQUM3QixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7b0JBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTO29CQUMvRCxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVM7aUJBQ2pFO2FBQ0Y7U0FDRixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0ksZ0JBQWdCO1FBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDdEMsTUFBTSxJQUFJLEtBQUssQ0FBQyw2REFBNkQsQ0FBQyxDQUFDO1NBQ2hGO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDaEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztTQUN2QztRQUNELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNyQixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ssZ0JBQWdCO1FBQ3RCLHVGQUF1RjtRQUN2RixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQztRQUN2QyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQzdELENBQUM7Q0FDRjtBQWhIRCw4QkFnSEM7QUF1REQ7Ozs7O0dBS0c7QUFDSCxNQUFhLG1CQUFvQixTQUFRLHFCQUFTO0lBZ0JoRCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQStCO1FBQ3ZFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFakIsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsU0FBUyxJQUFJLEdBQUcsQ0FBQztRQUN4QyxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO1FBRWxDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxTQUFTLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRTtZQUM1QyxXQUFXLEVBQUUsS0FBSyxDQUFDLFdBQVc7WUFDOUIsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO1lBQzFCLGFBQWEsRUFBRSxLQUFLLENBQUMsYUFBYTtZQUNsQyxNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07WUFDcEIsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUM7U0FDL0MsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0ksZ0JBQWdCO1FBQ3JCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxFQUFFLENBQUM7UUFFL0MsTUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBQ2YsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDcEMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNoRTtRQUVELE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztDQUNGO0FBNUNELGtEQTRDQztBQUVELFNBQVMsRUFBRTtJQUNULG9FQUFvRTtJQUNwRSxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDNUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENmbkVsZW1lbnQgfSBmcm9tICcuL2Nmbi1lbGVtZW50JztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJy4vY29uc3RydWN0JztcblxuZXhwb3J0IGludGVyZmFjZSBDZm5PdXRwdXRQcm9wcyB7XG4gIC8qKlxuICAgKiBBIFN0cmluZyB0eXBlIHRoYXQgZGVzY3JpYmVzIHRoZSBvdXRwdXQgdmFsdWUuXG4gICAqIFRoZSBkZXNjcmlwdGlvbiBjYW4gYmUgYSBtYXhpbXVtIG9mIDQgSyBpbiBsZW5ndGguXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gZGVzY3JpcHRpb24uXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eSByZXR1cm5lZCBieSB0aGUgYXdzIGNsb3VkZm9ybWF0aW9uIGRlc2NyaWJlLXN0YWNrcyBjb21tYW5kLlxuICAgKiBUaGUgdmFsdWUgb2YgYW4gb3V0cHV0IGNhbiBpbmNsdWRlIGxpdGVyYWxzLCBwYXJhbWV0ZXIgcmVmZXJlbmNlcywgcHNldWRvLXBhcmFtZXRlcnMsXG4gICAqIGEgbWFwcGluZyB2YWx1ZSwgb3IgaW50cmluc2ljIGZ1bmN0aW9ucy5cbiAgICovXG4gIHJlYWRvbmx5IHZhbHVlOiBhbnk7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIHVzZWQgdG8gZXhwb3J0IHRoZSB2YWx1ZSBvZiB0aGlzIG91dHB1dCBhY3Jvc3Mgc3RhY2tzLlxuICAgKlxuICAgKiBUbyBpbXBvcnQgdGhlIHZhbHVlIGZyb20gYW5vdGhlciBzdGFjaywgdXNlIGBGbkltcG9ydFZhbHVlKGV4cG9ydClgLiBZb3VcbiAgICogY2FuIGNyZWF0ZSBhbiBpbXBvcnQgdmFsdWUgdG9rZW4gYnkgY2FsbGluZyBgb3V0cHV0Lm1ha2VJbXBvcnRWYWx1ZSgpYC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBdXRvbWF0aWNhbGx5IGFsbG9jYXRlIGEgbmFtZSB3aGVuIGBtYWtlSW1wb3J0VmFsdWUoKWAgaXNcbiAgICogY2FsbGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgZXhwb3J0Pzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBEaXNhYmxlcyB0aGUgYXV0b21hdGljIGFsbG9jYXRpb24gb2YgYW4gZXhwb3J0IG5hbWUgZm9yIHRoaXMgb3V0cHV0LlxuICAgKlxuICAgKiBUaGlzIHByb2hpYml0cyBleHBvcnRpbmcgdGhpcyB2YWx1ZSwgZWl0aGVyIGJ5IHNwZWNpZnlpbmcgYGV4cG9ydGAgb3JcbiAgICogYnkgY2FsbGluZyBgbWFrZUltcG9ydFZhbHVlKClgLlxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgZGlzYWJsZUV4cG9ydD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEEgY29uZGl0aW9uIGZyb20gdGhlIFwiQ29uZGl0aW9uc1wiIHNlY3Rpb24gdG8gYXNzb2NpYXRlIHdpdGggdGhpcyBvdXRwdXRcbiAgICogdmFsdWUuIElmIHRoZSBjb25kaXRpb24gZXZhbHVhdGVzIHRvIGBmYWxzZWAsIHRoaXMgb3V0cHV0IHZhbHVlIHdpbGwgbm90XG4gICAqIGJlIGluY2x1ZGVkIGluIHRoZSBzdGFjay5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBjb25kaXRpb24gaXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBvdXRwdXQuXG4gICAqL1xuICByZWFkb25seSBjb25kaXRpb24/OiBDZm5Db25kaXRpb247XG59XG5cbmV4cG9ydCBjbGFzcyBDZm5PdXRwdXQgZXh0ZW5kcyBDZm5FbGVtZW50IHtcbiAgLyoqXG4gICAqIEEgU3RyaW5nIHR5cGUgdGhhdCBkZXNjcmliZXMgdGhlIG91dHB1dCB2YWx1ZS5cbiAgICogVGhlIGRlc2NyaXB0aW9uIGNhbiBiZSBhIG1heGltdW0gb2YgNCBLIGluIGxlbmd0aC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIHJlc291cmNlIG91dHB1dCB0byBiZSBleHBvcnRlZCBmb3IgYSBjcm9zcy1zdGFjayByZWZlcmVuY2UuXG4gICAqIEJ5IGRlZmF1bHQsIHRoZSBsb2dpY2FsIElEIG9mIHRoZSBDZm5PdXRwdXQgZWxlbWVudCBpcyB1c2VkIGFzIGl0J3MgZXhwb3J0IG5hbWUuXG4gICAqXG4gICAqIE1heSBiZSB1bmRlZmluZWQgaWYgdGhlIENmbk91dHB1dCBoYXNuJ3QgYmVlbiBleHBvcnRlZCB5ZXQuXG4gICAqL1xuICBwdWJsaWMgZXhwb3J0Pzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBIGNvbmRpdGlvbiBmcm9tIHRoZSBcIkNvbmRpdGlvbnNcIiBzZWN0aW9uIHRvIGFzc29jaWF0ZSB3aXRoIHRoaXMgb3V0cHV0XG4gICAqIHZhbHVlLiBJZiB0aGUgY29uZGl0aW9uIGV2YWx1YXRlcyB0byBgZmFsc2VgLCB0aGlzIG91dHB1dCB2YWx1ZSB3aWxsIG5vdFxuICAgKiBiZSBpbmNsdWRlZCBpbiB0aGUgc3RhY2suXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY29uZGl0aW9uPzogQ2ZuQ29uZGl0aW9uO1xuXG4gIHByaXZhdGUgX3ZhbHVlPzogYW55O1xuXG4gIHByaXZhdGUgZGlzYWJsZUV4cG9ydDogYm9vbGVhbjtcblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBDZm5PdXRwdXQgdmFsdWUgZm9yIHRoaXMgc3RhY2suXG4gICAqIEBwYXJhbSBzY29wZSBUaGUgcGFyZW50IGNvbnN0cnVjdC5cbiAgICogQHBhcmFtIHByb3BzIENmbk91dHB1dCBwcm9wZXJ0aWVzLlxuICAgKi9cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IENmbk91dHB1dFByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIGlmIChwcm9wcy52YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgdmFsdWUgZm9yIENsb3VkRm9ybWF0aW9uIG91dHB1dCBhdCBwYXRoIFwiJHt0aGlzLm5vZGUucGF0aH1cImApO1xuICAgIH1cblxuICAgIHRoaXMuZGVzY3JpcHRpb24gPSBwcm9wcy5kZXNjcmlwdGlvbjtcbiAgICB0aGlzLl92YWx1ZSA9IHByb3BzLnZhbHVlO1xuICAgIHRoaXMuY29uZGl0aW9uID0gcHJvcHMuY29uZGl0aW9uO1xuXG4gICAgdGhpcy5kaXNhYmxlRXhwb3J0ID0gcHJvcHMuZGlzYWJsZUV4cG9ydCAhPT0gdW5kZWZpbmVkID8gcHJvcHMuZGlzYWJsZUV4cG9ydCA6IGZhbHNlO1xuXG4gICAgaWYgKHByb3BzLmV4cG9ydCAmJiB0aGlzLmRpc2FibGVFeHBvcnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNldCBgZGlzYWJsZUV4cG9ydGAgYW5kIHNwZWNpZnkgYW4gZXhwb3J0IG5hbWUnKTtcbiAgICB9XG5cbiAgICB0aGlzLmV4cG9ydCA9IHByb3BzLmV4cG9ydDtcblxuICAgIGlmIChwcm9wcy5leHBvcnQpIHtcbiAgICAgIHRoaXMuZXhwb3J0ID0gcHJvcHMuZXhwb3J0O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgdmFsdWUgb2YgdGhlIHByb3BlcnR5IHJldHVybmVkIGJ5IHRoZSBhd3MgY2xvdWRmb3JtYXRpb24gZGVzY3JpYmUtc3RhY2tzIGNvbW1hbmQuXG4gICAqIFRoZSB2YWx1ZSBvZiBhbiBvdXRwdXQgY2FuIGluY2x1ZGUgbGl0ZXJhbHMsIHBhcmFtZXRlciByZWZlcmVuY2VzLCBwc2V1ZG8tcGFyYW1ldGVycyxcbiAgICogYSBtYXBwaW5nIHZhbHVlLCBvciBpbnRyaW5zaWMgZnVuY3Rpb25zLlxuICAgKi9cbiAgcHVibGljIGdldCB2YWx1ZSgpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIEZuSW1wb3J0VmFsdWUgYm91bmQgdG8gdGhpcyBleHBvcnQgbmFtZS5cbiAgICovXG4gIHB1YmxpYyBtYWtlSW1wb3J0VmFsdWUoKSB7XG4gICAgcmV0dXJuIGZuKCkuaW1wb3J0VmFsdWUodGhpcy5vYnRhaW5FeHBvcnROYW1lKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcHVibGljIF90b0Nsb3VkRm9ybWF0aW9uKCk6IG9iamVjdCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIE91dHB1dHM6IHtcbiAgICAgICAgW3RoaXMubG9naWNhbElkXToge1xuICAgICAgICAgIERlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIFZhbHVlOiB0aGlzLnZhbHVlLFxuICAgICAgICAgIEV4cG9ydDogdGhpcy5leHBvcnQgIT0gbnVsbCA/IHsgTmFtZTogdGhpcy5leHBvcnQgfSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICBDb25kaXRpb246IHRoaXMuY29uZGl0aW9uID8gdGhpcy5jb25kaXRpb24ubG9naWNhbElkIDogdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFsbG9jYXRlIGFuIGV4cG9ydCBuYW1lIGZvciB0aGlzIGBDZm5PdXRwdXRgIGlmIG5vdCBhbHJlYWR5IGRvbmUuXG4gICAqL1xuICBwdWJsaWMgb2J0YWluRXhwb3J0TmFtZSgpOiBzdHJpbmcge1xuICAgIGlmICghdGhpcy5leHBvcnQgJiYgdGhpcy5kaXNhYmxlRXhwb3J0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjcmVhdGUgYW4gSW1wb3J0VmFsdWU7IGBkaXNhYmxlRXhwb3J0YCBoYXMgYmVlbiBzZXQuJyk7XG4gICAgfVxuICAgIGlmICghdGhpcy5leHBvcnQpIHtcbiAgICAgIHRoaXMuZXhwb3J0ID0gdGhpcy51bmlxdWVPdXRwdXROYW1lKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmV4cG9ydDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdXRvbWF0aWNhbGx5IGRldGVybWluZSBhbiBvdXRwdXQgbmFtZSBmb3IgdXNlIHdpdGggRm5JbXBvcnRWYWx1ZVxuICAgKlxuICAgKiBUaGlzIGdldHMgY2FsbGVkIGluIGNhc2UgdGhlIHVzZXIgaGFzbid0IHNwZWNpZmllZCBhbiBleHBvcnQgbmFtZSBidXQgaXNcbiAgICogdGFraW5nIGFuIGFjdGlvbiB0aGF0IHJlcXVpcmVzIGV4cG9ydGluZy4gV2UgbmFtZXNwYWNlIHdpdGggdGhlIHN0YWNrIG5hbWVcbiAgICogdG8gcmVkdWNlIGNoYW5jZXMgb2YgY29sbGlzc2lvbnMgYmV0d2VlbiBDREsgYXBwcy5cbiAgICovXG4gIHByaXZhdGUgdW5pcXVlT3V0cHV0TmFtZSgpIHtcbiAgICAvLyBwcmVmaXggZXhwb3J0IG5hbWUgd2l0aCBzdGFjayBuYW1lIHNpbmNlIGV4cG9ydHMgYXJlIGdsb2JhbCB3aXRoaW4gYWNjb3VudCArIHJlZ2lvbi5cbiAgICBjb25zdCBzdGFja05hbWUgPSB0aGlzLnN0YWNrLnN0YWNrTmFtZTtcbiAgICByZXR1cm4gKHN0YWNrTmFtZSA/IHN0YWNrTmFtZSArICc6JyA6ICcnKSArIHRoaXMubG9naWNhbElkO1xuICB9XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgTGlzdE91dHB1dFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFN0cmluZ0xpc3RDZm5PdXRwdXRQcm9wcyB7XG4gIC8qKlxuICAgKiBBIFN0cmluZyB0eXBlIHRoYXQgZGVzY3JpYmVzIHRoZSBvdXRwdXQgdmFsdWUuXG4gICAqIFRoZSBkZXNjcmlwdGlvbiBjYW4gYmUgYSBtYXhpbXVtIG9mIDQgSyBpbiBsZW5ndGguXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gZGVzY3JpcHRpb24uXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGxpc3Qgb2YgcHJpbWl0aXZlcyB0byBleHBvcnRcbiAgICovXG4gIHJlYWRvbmx5IHZhbHVlczogYW55W107XG5cbiAgLyoqXG4gICAqIFRoZSBzZXBhcmF0b3IgdG8gdXNlIHRvIHNlcGFyYXRlIHN0cmluZ2lmaWVkIHZhbHVlc1xuICAgKlxuICAgKiBAZGVmYXVsdCBcIixcIlxuICAgKi9cbiAgcmVhZG9ubHkgc2VwYXJhdG9yPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSB1c2VkIHRvIGV4cG9ydCB0aGUgdmFsdWUgb2YgdGhpcyBvdXRwdXQgYWNyb3NzIHN0YWNrcy4gVG8gaW1wb3J0XG4gICAqIHRoZSB2YWx1ZSBmcm9tIGFub3RoZXIgc3RhY2ssIHVzZSBgRm5JbXBvcnRWYWx1ZShleHBvcnQpYC4gWW91IGNhbiBjcmVhdGVcbiAgICogYW4gaW1wb3J0IHZhbHVlIHRva2VuIGJ5IGNhbGxpbmcgYG91dHB1dC5tYWtlSW1wb3J0VmFsdWUoKWAuXG4gICAqXG4gICAqIEBkZWZhdWx0IFRoZSBkZWZhdWx0IGJlaGF2aW9yIGlzIHRvIGF1dG9tYXRpY2FsbHkgYWxsb2NhdGUgYW4gZXhwb3J0IG5hbWVcbiAgICogZm9yIG91dHB1dHMgYmFzZWQgb24gdGhlIHN0YWNrIG5hbWUgYW5kIHRoZSBvdXRwdXQncyBsb2dpY2FsIElELiBUb1xuICAgKiBjcmVhdGUgYW4gb3V0cHV0IHdpdGhvdXQgYW4gZXhwb3J0LCBzZXQgYGRpc2FibGVFeHBvcnQ6IHRydWVgLlxuICAgKi9cbiAgcmVhZG9ubHkgZXhwb3J0Pzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBEaXNhYmxlcyB0aGUgYXV0b21hdGljIGFsbG9jYXRpb24gb2YgYW4gZXhwb3J0IG5hbWUgZm9yIHRoaXMgb3V0cHV0LlxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZSwgd2hpY2ggbWVhbnMgdGhhdCBhbiBleHBvcnQgbmFtZSBpcyBlaXRoZXIgZXhwbGljaXRseVxuICAgKiBzcGVjaWZpZWQgb3IgYWxsb2NhdGVkIGJhc2VkIG9uIHRoZSBvdXRwdXQncyBsb2dpY2FsIElEIGFuZCBzdGFjayBuYW1lLlxuICAgKi9cbiAgcmVhZG9ubHkgZGlzYWJsZUV4cG9ydD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEEgY29uZGl0aW9uIGZyb20gdGhlIFwiQ29uZGl0aW9uc1wiIHNlY3Rpb24gdG8gYXNzb2NpYXRlIHdpdGggdGhpcyBvdXRwdXRcbiAgICogdmFsdWUuIElmIHRoZSBjb25kaXRpb24gZXZhbHVhdGVzIHRvIGBmYWxzZWAsIHRoaXMgb3V0cHV0IHZhbHVlIHdpbGwgbm90XG4gICAqIGJlIGluY2x1ZGVkIGluIHRoZSBzdGFjay5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBOb25lLlxuICAgKi9cbiAgcmVhZG9ubHkgY29uZGl0aW9uPzogQ2ZuQ29uZGl0aW9uO1xufVxuXG4vKipcbiAqIEFuIG91dHB1dCBmb3IgYSBsaXN0IG9mIHN0cmluZ3MuXG4gKlxuICogRXhwb3J0cyBhIGxpc3Qgb2YgVG9rZW5zIHZpYSBhbiBDZm5PdXRwdXQgdmFyaWFibGUsIGFuZCByZXR1cm4gYSBsaXN0IG9mIFRva2Vuc1xuICogdGhhdCBzZWxlY3RzIHRoZSBpbXBvcnRlZCB2YWx1ZXMgZm9yIHRoZW0uXG4gKi9cbmV4cG9ydCBjbGFzcyBTdHJpbmdMaXN0Q2ZuT3V0cHV0IGV4dGVuZHMgQ29uc3RydWN0IHtcbiAgLyoqXG4gICAqIE51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgc3RyaW5nbGlzdFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGxlbmd0aDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgc2VwYXJhdG9yIHVzZWQgdG8gY29tYmluZSB0aGUgc3RyaW5nIHZhbHVlc1xuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBzZXBhcmF0b3I6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIENmbk91dHB1dCBvYmplY3QgdGhhdCB3YXMgY3JlYXRlZFxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBvdXRwdXQ6IENmbk91dHB1dDtcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogU3RyaW5nTGlzdENmbk91dHB1dFByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIHRoaXMuc2VwYXJhdG9yID0gcHJvcHMuc2VwYXJhdG9yIHx8ICcsJztcbiAgICB0aGlzLmxlbmd0aCA9IHByb3BzLnZhbHVlcy5sZW5ndGg7XG5cbiAgICB0aGlzLm91dHB1dCA9IG5ldyBDZm5PdXRwdXQodGhpcywgJ1Jlc291cmNlJywge1xuICAgICAgZGVzY3JpcHRpb246IHByb3BzLmRlc2NyaXB0aW9uLFxuICAgICAgY29uZGl0aW9uOiBwcm9wcy5jb25kaXRpb24sXG4gICAgICBkaXNhYmxlRXhwb3J0OiBwcm9wcy5kaXNhYmxlRXhwb3J0LFxuICAgICAgZXhwb3J0OiBwcm9wcy5leHBvcnQsXG4gICAgICB2YWx1ZTogZm4oKS5qb2luKHRoaXMuc2VwYXJhdG9yLCBwcm9wcy52YWx1ZXMpXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGFuIGFycmF5IG9mIGltcG9ydGVkIHZhbHVlcyBmb3IgdGhpcyBDZm5PdXRwdXRcbiAgICovXG4gIHB1YmxpYyBtYWtlSW1wb3J0VmFsdWVzKCk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBjb21iaW5lZCA9IHRoaXMub3V0cHV0Lm1ha2VJbXBvcnRWYWx1ZSgpO1xuXG4gICAgY29uc3QgcmV0ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICByZXQucHVzaChmbigpLnNlbGVjdChpLCBmbigpLnNwbGl0KHRoaXMuc2VwYXJhdG9yLCBjb21iaW5lZCkpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmV0O1xuICB9XG59XG5cbmZ1bmN0aW9uIGZuKCkge1xuICAvLyBMYXp5IGxvYWRpbmcgb2YgXCJGblwiIG1vZHVsZSB0byBicmVhayBkZXBlbmRlbmN5IGN5Y2xlcyBvbiBzdGFydHVwXG4gIHJldHVybiByZXF1aXJlKCcuL2ZuJykuRm47XG59XG5cbmltcG9ydCB7IENmbkNvbmRpdGlvbiB9IGZyb20gJy4vY2ZuLWNvbmRpdGlvbic7XG4iXX0=